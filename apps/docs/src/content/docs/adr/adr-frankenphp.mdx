---
title: "📜 Packaging d’une application locale avec FrankenPHP, API Platform et monorepo"
description: "Décision d’architecture pour une application locale packagée en binaire unique avec FrankenPHP, API Platform et moonrepo."
---
## Contexte

Nous voulons construire une application **locale** qui :

- Fournit un **backend API** basé sur Laravel + API Platform.
- Expose une **interface CLI** et une **interface TUI**.
- Peut évoluer vers une **interface web** plus tard.
- Est packagée en **binaire unique** avec FrankenPHP (`./monapp commande arguments`).
- Utilise un **monorepo** (moonrepo) pour organiser les différents modules.
- Gère un **lazy daemon** : le serveur web démarre automatiquement si nécessaire, et s’arrête après inactivité.
- Supporte une **persistance de données locale** (SQLite au départ, extensible ensuite).

---

## Décisions

1. **Monorepo avec moonrepo**
Organisation en workspaces :
- `apps/api` → Laravel + API Platform
- `apps/cli` → CLI (Symfony Console ou Node Commander.js)
- `apps/tui` → TUI (PHP CLI-menu ou Node Ink/Blessed)
- `libs/domain` → logique métier partagée
- `libs/infrastructure` → persistence, services techniques

2. **FrankenPHP comme runtime unique**
- Permet de packager API + CLI + PHP runtime dans un seul binaire.
- Fournit un serveur web “always-ready”.

3. **Lazy daemon**
- Le binaire `monapp` démarre FrankenPHP si nécessaire avant d’exécuter une commande.
- Un watchdog arrête le serveur après X minutes d’inactivité.

4. **Persistance locale**
- Base de données SQLite par défaut, stockée dans un répertoire `data/`.
- Migration future vers Postgres/MySQL possible.

5. **Distribution**
- Build avec `frankenphp build` → génère un seul binaire (`./monapp`).
- Compatible Linux/MacOS (Windows avec WSL en fallback).

---

## Conséquences

- ✅ Expérience développeur simple (moonrepo + PHP/Node).
- ✅ Expérience utilisateur fluide (`./monapp books:list`).
- ✅ Évolution naturelle vers une interface web.
- ⚠️ Complexité technique initiale (FrankenPHP + monorepo + lazy daemon).
- ⚠️ Taille du binaire >50MB (runtime PHP inclus).
