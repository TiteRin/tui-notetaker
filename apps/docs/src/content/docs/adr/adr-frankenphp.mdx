---
title: "ðŸ“œ Packaging dâ€™une application locale avec FrankenPHP, API Platform et monorepo"
description: "DÃ©cision dâ€™architecture pour une application locale packagÃ©e en binaire unique avec FrankenPHP, API Platform et moonrepo."
---
## Contexte

Nous voulons construire une application **locale** qui :

- Fournit un **backend API** basÃ© sur Laravel + API Platform.
- Expose une **interface CLI** et une **interface TUI**.
- Peut Ã©voluer vers une **interface web** plus tard.
- Est packagÃ©e en **binaire unique** avec FrankenPHP (`./monapp commande arguments`).
- Utilise un **monorepo** (moonrepo) pour organiser les diffÃ©rents modules.
- GÃ¨re un **lazy daemon** : le serveur web dÃ©marre automatiquement si nÃ©cessaire, et sâ€™arrÃªte aprÃ¨s inactivitÃ©.
- Supporte une **persistance de donnÃ©es locale** (SQLite au dÃ©part, extensible ensuite).

---

## DÃ©cisions

1. **Monorepo avec moonrepo**
Organisation en workspaces :
- `apps/api` â†’ Laravel + API Platform
- `apps/cli` â†’ CLI (Symfony Console ou Node Commander.js)
- `apps/tui` â†’ TUI (PHP CLI-menu ou Node Ink/Blessed)
- `libs/domain` â†’ logique mÃ©tier partagÃ©e
- `libs/infrastructure` â†’ persistence, services techniques

2. **FrankenPHP comme runtime unique**
- Permet de packager API + CLI + PHP runtime dans un seul binaire.
- Fournit un serveur web â€œalways-readyâ€.

3. **Lazy daemon**
- Le binaire `monapp` dÃ©marre FrankenPHP si nÃ©cessaire avant dâ€™exÃ©cuter une commande.
- Un watchdog arrÃªte le serveur aprÃ¨s X minutes dâ€™inactivitÃ©.

4. **Persistance locale**
- Base de donnÃ©es SQLite par dÃ©faut, stockÃ©e dans un rÃ©pertoire `data/`.
- Migration future vers Postgres/MySQL possible.

5. **Distribution**
- Build avec `frankenphp build` â†’ gÃ©nÃ¨re un seul binaire (`./monapp`).
- Compatible Linux/MacOS (Windows avec WSL en fallback).

---

## ConsÃ©quences

- âœ… ExpÃ©rience dÃ©veloppeur simple (moonrepo + PHP/Node).
- âœ… ExpÃ©rience utilisateur fluide (`./monapp books:list`).
- âœ… Ã‰volution naturelle vers une interface web.
- âš ï¸ ComplexitÃ© technique initiale (FrankenPHP + monorepo + lazy daemon).
- âš ï¸ Taille du binaire >50MB (runtime PHP inclus).
